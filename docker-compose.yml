version: '3.9'
services:
  gateway:
    build: ./gateway
    container_name: gateway_service
    command: ["npm", "start"]
    ports:
      - "4000:4000"
    environment:
      - PORT=4000
      - NODE_ENV=development
    depends_on:
      - ai
      - media
      - auth
      - data
    networks:
      - microservice_net

  ai:
    build: ./microservices/ai
    container_name: ai_service
    command: ["npm", "start"]
    ports:
      - "5001:5001"
    environment:
      - AI_PORT=5001
      - NODE_ENV=development
      - MONGO_URI=mongodb://ai_db:27017/aidb
    networks:
      - microservice_net

  media:
    build: ./microservices/media
    container_name: media_service
    command: ["npm", "start"]
    ports:
      - "5002:5002"
    environment:
      - MEDIA_PORT=5002
      - NODE_ENV=development
      - MONGO_URI=mongodb://media_db:27017/mediadb
    networks:
      - microservice_net

  auth:
    build: ./microservices/auth
    container_name: auth_service
    command: ["npm", "start"]
    ports:
      - "5003:5003"
    environment:
      - AUTH_PORT=5003
      - NODE_ENV=development
      - MONGO_URI=mongodb://auth_db:27017/authdb
    networks:
      - microservice_net

  data:
    build: ./microservices/data
    container_name: data_service
    command: ["npm", "start"]
    ports:
      - "5004:5004"
    environment:
      - DATA_PORT=5004
      - NODE_ENV=development
      - MONGO_URI=mongodb://data_db:27017/datadb
    networks:
      - microservice_net

  auth_db:
    image: mongo:4.4
    container_name: auth_db
    ports:
      - "27017:27017"
    networks:
      - microservice_net

  data_db:
    image: mongo:4.4
    container_name: data_db
    ports:
      - "27018:27017"
    networks:
      - microservice_net

  ai_db:
    image: mongo:4.4
    container_name: ai_db
    ports:
      - "27019:27017"
    networks:
      - microservice_net

  media_db:
    image: mongo:4.4
    container_name: media_db
    ports:
      - "27020:27017"
    networks:
      - microservice_net

networks:
  microservice_net:
    driver: bridge
